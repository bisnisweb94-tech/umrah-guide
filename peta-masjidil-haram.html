<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Digital Masjidil Haram</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-sidebar-v2@3.1.1/css/leaflet-sidebar.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* Styling Sidebar List */
        .location-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .location-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
        }

        .location-item:hover {
            background-color: #f8f9fa;
        }

        .location-icon {
            margin-right: 15px;
            color: #bfa15f;
            /* Warna Emas Masjid */
            font-size: 1.2em;
        }

        .location-info h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
            color: #333;
        }

        .location-info p {
            margin: 0;
            font-size: 12px;
            color: #666;
        }

        /* Search Box di Sidebar */
        .search-container {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 10;
        }

        .search-box {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }

        /* Custom Marker Style */
        .custom-div-icon {
            background: #bfa15f;
            border: 2px solid white;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body>

    <div id="sidebar" class="leaflet-sidebar collapsed">
        <div class="leaflet-sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
                <li><a href="#info" role="tab"><i class="fa fa-info-circle"></i></a></li>
            </ul>
        </div>

        <div class="leaflet-sidebar-content">
            <div class="leaflet-sidebar-pane" id="home">
                <h1 class="leaflet-sidebar-header">
                    Lokasi Penting
                    <span class="leaflet-sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>

                <div class="search-container">
                    <input type="text" id="searchInput" class="search-box" placeholder="Cari gerbang, area..."
                        onkeyup="filterList()">
                </div>

                <ul class="location-list" id="sidebarList">
                </ul>
            </div>

            <div class="leaflet-sidebar-pane" id="info">
                <h1 class="leaflet-sidebar-header">Tentang Peta<span class="leaflet-sidebar-close"><i
                            class="fa fa-caret-left"></i></span></h1>
                <div style="padding: 20px;">
                    <h3>Panduan Masjidil Haram</h3>
                    <p>Peta interaktif ini menggabungkan data satelit Google Maps dengan peta skematik detail fasilitas
                        masjid.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-sidebar-v2@3.1.1/js/leaflet-sidebar.min.js"></script>

    <script>
        // --- 1. Inisialisasi Peta ---
        // Koordinat Pusat Ka'bah
        const kaabaCoords = [21.422487, 39.826206];
        const map = L.map('map', {
            center: kaabaCoords,
            zoom: 18,
            zoomControl: false // Kita pindahkan zoom control nanti
        });

        // Tambahkan Zoom Control di sebelah kanan agar tidak tertutup sidebar
        L.control.zoom({ position: 'topright' }).addTo(map);

        // --- 2. Base Layers (Google Maps Hybrid Style) ---
        // Menggunakan tile layer standar OSM sebagai contoh (bisa diganti Google Tiles jika punya API Key)
        const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri',
            maxZoom: 19
        }).addTo(map);

        // --- 3. Image Overlay (Peta Buatan Anda) ---
        // Ganti URL gambar di bawah dengan gambar peta hasil georeferencing Anda
        const imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Great_Mosque_of_Mecca.jpg/1280px-Great_Mosque_of_Mecca.jpg';
        // Batas koordinat (SouthWest, NorthEast) - Hasil dari QGIS Anda
        const imageBounds = [[21.419, 39.822], [21.426, 39.830]];

        L.imageOverlay(imageUrl, imageBounds, {
            opacity: 0.7,
            interactive: true
        }).addTo(map);

        // --- 4. Sidebar Setup ---
        const sidebar = L.control.sidebar({
            container: 'sidebar',
            position: 'left'
        }).addTo(map);

        // Buka sidebar saat load
        sidebar.open('home');

        // --- 5. Data GeoJSON (Landmarks) ---
        // Data ini meniru struktur data dari link yang Anda kirim
        const landmarksData = [
            {
                "type": "Feature",
                "properties": { "name": "Ka'bah", "type": "Holy Site", "icon": "fa-kaaba" },
                "geometry": { "type": "Point", "coordinates": [39.826206, 21.422487] }
            },
            {
                "type": "Feature",
                "properties": { "name": "Maqam Ibrahim", "type": "Holy Site", "icon": "fa-cube" },
                "geometry": { "type": "Point", "coordinates": [39.82635, 21.42255] }
            },
            {
                "type": "Feature",
                "properties": { "name": "King Abdulaziz Gate (No. 1)", "type": "Gate", "icon": "fa-archway" },
                "geometry": { "type": "Point", "coordinates": [39.825472, 21.417863] }
            },
            {
                "type": "Feature",
                "properties": { "name": "King Fahd Gate (No. 79)", "type": "Gate", "icon": "fa-archway" },
                "geometry": { "type": "Point", "coordinates": [39.821100, 21.421200] }
            },
            {
                "type": "Feature",
                "properties": { "name": "Bukit Safa", "type": "Landmark", "icon": "fa-mountain" },
                "geometry": { "type": "Point", "coordinates": [39.828611, 21.423056] }
            },
            {
                "type": "Feature",
                "properties": { "name": "Bukit Marwah", "type": "Landmark", "icon": "fa-mountain" },
                "geometry": { "type": "Point", "coordinates": [39.826111, 21.426389] }
            },
            {
                "type": "Feature",
                "properties": { "name": "Bab Al-Salam", "type": "Gate", "icon": "fa-door-open" },
                "geometry": { "type": "Point", "coordinates": [39.828500, 21.423800] }
            },
            {
                "type": "Feature",
                "properties": { "name": "Bab Al-Fatah", "type": "Gate", "icon": "fa-door-open" },
                "geometry": { "type": "Point", "coordinates": [39.827200, 21.426500] }
            }
        ];

        // --- 6. Logika Render Markers & Sidebar ---
        const markersLayer = L.layerGroup().addTo(map);
        const sidebarList = document.getElementById('sidebarList');

        function renderData(data) {
            // Bersihkan list & markers
            sidebarList.innerHTML = '';
            markersLayer.clearLayers();

            data.forEach(feature => {
                const props = feature.properties;
                const coords = feature.geometry.coordinates; // GeoJSON: [Lon, Lat]
                const latLng = [coords[1], coords[0]]; // Leaflet: [Lat, Lon]

                // 1. Tambahkan Marker ke Peta
                const marker = L.marker(latLng).bindPopup(`<b>${props.name}</b><br>${props.type}`);
                markersLayer.addLayer(marker);

                // 2. Tambahkan Item ke Sidebar
                const listItem = document.createElement('li');
                listItem.className = 'location-item';
                listItem.innerHTML = `
                    <div class="location-icon"><i class="fa ${props.icon}"></i></div>
                    <div class="location-info">
                        <h4>${props.name}</h4>
                        <p>${props.type}</p>
                    </div>
                `;

                // Event Klik pada List Item
                listItem.addEventListener('click', () => {
                    // Zoom ke lokasi
                    map.setView(latLng, 19, { animate: true });
                    // Buka popup marker
                    marker.openPopup();
                    // Di mobile, tutup sidebar setelah klik agar peta terlihat
                    if (window.innerWidth < 768) {
                        sidebar.close();
                    }
                });

                sidebarList.appendChild(listItem);
            });
        }

        // Render data awal
        renderData(landmarksData);

        // --- 7. Fitur Pencarian ---
        window.filterList = function () {
            const query = document.getElementById('searchInput').value.toLowerCase();

            const filteredData = landmarksData.filter(feature => {
                return feature.properties.name.toLowerCase().includes(query) ||
                    feature.properties.type.toLowerCase().includes(query);
            });

            renderData(filteredData);
        }

    </script>
</body>

</html>